---
timestamp: 'Wed Oct 15 2025 22:15:14 GMT-0400 (Eastern Daylight Time)'
parent: '[[../20251015_221514.b5b63c46.md]]'
content_id: 49da13468861a53a399beefcf67b5b26752d49946733358d64b5acb3438d2254
---

# Concept FileUrl \[User]

* **purpose**: to let files be uploaded securely and displayed, managing their access through an external storage service.

* **principle**: A user can initiate a file upload to a trusted external storage service, receive a temporary URL to perform the upload directly, and later request a temporary, pre-signed URL to access or display that file.

* **state**
  * a set of `File` with
    * an `id`
    * an `owner` of type `User`
    * a `fileName` of type `string`
    * a `storageKey` of type `string` (a unique key/path identifying the file within the external storage service, e.g., "bucket/folder/uuid.ext")
    * a `mimeType` of type `string` (the MIME type of the file, e.g., "image/jpeg")
    * a `fileSize` of type `Number` (the size of the file in bytes)
    * an `uploaded` of type `Boolean` (true once the file content has been successfully uploaded to the external service)

* **actions**

  * `initiateFileUpload (fileName: String, owner: User, mimeType: String, fileSize: Number): (file: File, uploadUrl: String)`
    * **requires**: `fileName` is non-empty, `owner` is a valid user, `mimeType` is a recognized type, `fileSize` is positive.
    * **effects**: Creates a new `File` entity with a unique `id`. Assigns `owner`, `fileName`, `mimeType`, `fileSize` to the new `file` Generates a unique `storageKey` for the `file` (e.g., using `id` and `fileName`). Requests a *pre-signed upload URL* from the external storage service for this `storageKey`, `mimeType`, and `fileSize`. This URL allows a client to directly upload the file content to the storage service. Sets `uploaded` to `false`. Returns the new `file` (its `id`) and the generated `uploadUrl`.

  * `confirmFileUpload (file: File)`
    * **requires**: `file` exists in the concept's state and its `uploaded` property is `false`.
    * **effects**: Sets the `uploaded` property of the `file` to `true`. This action is typically called by the client or a webhook from the storage service after the direct upload using the `uploadUrl` has successfully completed.

  * `getDownloadUrl (file: File, user: User, expiresInSeconds: Number): (downloadUrl: String)`
    * **requires**: `file` exists, `user` is its `owner` (or authorized to access it based on application logic), `uploaded` is `true`, and `expiresInSeconds` is a positive number.
    * **effects**: Requests a *pre-signed download URL* from the external storage service for the `file`'s `storageKey` and `mimeType`. The generated `downloadUrl` is valid only for the specified `expiresInSeconds`. Returns this temporary `downloadUrl`.

  * `deleteFile (file: File, user: User)`
    * **requires**: `file` exists and `user` is its `owner`.
    * **effects**: Triggers the deletion of the actual file content from the external storage service using the `file`'s `storageKey`. Removes the `file` entity from the concept's state.
